<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8" />
  <title>Markdown 转纯文本</title>
  
  <!-- 引入 Water.css 以获得简洁美观的默认样式 -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/water.css@2/out/water.css">
  
  <!-- 引入 Markdown-it 库 -->
  <script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
</head>
<body>
  <h1>Markdown 转纯文本</h1>
  <p>在下面的文本框中输入你的 Markdown 内容，然后点击“转为纯文本”按钮。</p>
  
  <form id="markdownForm">
    <label for="markdownInput">Markdown 内容：</label>
    <textarea id="markdownInput" rows="6" placeholder="在这里输入 Markdown 格式文本"></textarea>
    
    <button type="button" id="convertBtn">转为纯文本</button>
  </form>
  
  <hr/>
  
  <h2>转换结果：</h2>
  <pre id="plainOutput" style="min-height: 3em;"></pre>
  
  <script>
    const convertBtn = document.getElementById('convertBtn');
    const markdownInput = document.getElementById('markdownInput');
    const plainOutput = document.getElementById('plainOutput');
    
    // 初始化 markdown-it
    const md = window.markdownit();

    /**
     * 递归遍历 DOM，保留列表序号或项目符号
     * @param {Node} node - 当前 DOM 节点
     * @returns {string} - 拼接后的纯文本
     */
    function getCustomPlainText(node) {
      let result = '';
      // 遍历子节点
      node.childNodes.forEach(child => {
        // 如果是文本节点，直接拼接文本
        if (child.nodeType === Node.TEXT_NODE) {
          result += child.nodeValue;
        }
        // 如果是元素节点，需要根据标签类型做区分
        else if (child.nodeType === Node.ELEMENT_NODE) {
          const tagName = child.tagName.toLowerCase();

          if (tagName === 'ol') {
            // 有序列表
            let index = 1;
            // 遍历所有子 <li>
            child.childNodes.forEach(li => {
              if (li.tagName && li.tagName.toLowerCase() === 'li') {
                // 前面加 "1. "、"2. "...
                result += index + '. ' + getCustomPlainText(li) + '\n';
                index++;
              }
            });
          } 
          else if (tagName === 'ul') {
            // 无序列表
            child.childNodes.forEach(li => {
              if (li.tagName && li.tagName.toLowerCase() === 'li') {
                // 前面加 "- "
                result += '• ' + getCustomPlainText(li) + '\n';
              }
            });
          } 
          else {
            // 其他标签(如 p, div, span 等)，递归获取文本
            result += getCustomPlainText(child);
          }
        }
      });
      return result;
    }

    convertBtn.addEventListener('click', function() {
      // 获取输入区域的 Markdown 文本
      const markdownText = markdownInput.value;
      
      // 将 Markdown 转为 HTML
      const renderedHtml = md.render(markdownText);
      
      // 创建一个临时标签存放渲染后的 HTML
      const tempDiv = document.createElement('div');
      tempDiv.innerHTML = renderedHtml;
      
      // 自定义函数：遍历 tempDiv，并且保留列表序号与项目前缀
      const plainText = getCustomPlainText(tempDiv);
      
      // 显示在页面上
      plainOutput.textContent = plainText.trim();
    });
  </script>
</body>
</html>
